<section class="w-full h-auto bg-black flex items-center justify-center">

  <div class="container mx-auto px-4 py-8">
    <!-- Barra de busqueda -->
    <div class="mb-8">
      <input type="text" [(ngModel)]="searchTerm" (input)="filterCars()"
        placeholder="Buscar carros por nombre, descripción o precio..."
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
    </div>

    @if (isLoading) {
    <div class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
      <p class="mt-4 text-gray-600">Cargando carros...</p>
    </div>
    }

    @if (error) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
      <strong class="font-bold">Error!</strong>
      <span class="block sm:inline">{{ error }}</span>
    </div>
    }

    @if (!isLoading && !error) {
    @if (filteredCars.length === 0) {
    <div class="text-center py-12">
      <p class="text-gray-600 text-xl">No se encontraron carros que coincidan con tu búsqueda.</p>
    </div>
    } @else {
    <!-- Cars Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (car of filteredCars; track car.id) {
      <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
        <img [src]="car.image" [alt]="car.name" class="w-full h-48 object-cover">
        <div class="p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-2">{{ car.name }}</h3>
          <p class="text-gray-600 mb-4">{{ car.description }}</p>
          <div class="flex justify-between items-center">
            <span class="text-lg font-semibold text-amber-400">${{ car.price }}</span>
            <button (click)="openModal(car)"
              class="px-4 py-2 bg-amber-400 text-white rounded hover:bg-blue-600 transition-colors">
              Ver detalles
            </button>
          </div>
        </div>
      </div>
      }
    </div>
    }
    }
  </div>

  @if (showModal) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-2xl font-bold text-gray-800">Solicitar información: {{selectedCar?.name}}</h3>
        <button (click)="showModal = false" class="text-gray-500 hover:text-gray-700">
          ✕
        </button>
      </div>

      <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- Nombre completo -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Nombre completo*</label>
          <input type="text" formControlName="fullName"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"
            [class.border-red-500]="carForm.get('fullName')?.invalid && carForm.get('fullName')?.touched">
          @if (carForm.get('fullName')?.invalid && carForm.get('fullName')?.touched) {
          <p class="text-red-500 text-sm mt-1">
            @if (carForm.get('fullName')?.errors?.['required']) {
            El nombre es requerido
            }
            @if (carForm.get('fullName')?.errors?.['minlength']) {
            (Mínimo 3 caracteres)
            }
          </p>
          }
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Email*</label>
          <input type="email" formControlName="email"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"
            [class.border-red-500]="carForm.get('email')?.invalid && carForm.get('email')?.touched">
          @if (carForm.get('email')?.invalid && carForm.get('email')?.touched) {
          <p class="text-red-500 text-sm mt-1">
            @if (carForm.get('email')?.errors?.['required']) {
            El email es requerido
            }
            @if (carForm.get('email')?.errors?.['email']) {
            Ingrese un email válido
            }
          </p>
          }
        </div>

        <!-- Método de pago (select) -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Método de pago*</label>
          <select formControlName="paymentMethod"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"
            [class.border-red-500]="carForm.get('paymentMethod')?.invalid && carForm.get('paymentMethod')?.touched">
            <option value="">Seleccione...</option>
            @for (method of paymentMethods; track method) {
            <option [value]="method">{{method}}</option>
            }
          </select>
          @if (carForm.get('paymentMethod')?.invalid && carForm.get('paymentMethod')?.touched) {
          <p class="text-red-500 text-sm mt-1">Seleccione un método de pago</p>
          }
        </div>

        <!-- Color (radio buttons) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Color preferido*</label>
          <div class="flex flex-wrap gap-4">
            @for (color of colors; track color) {
            <label class="inline-flex items-center">
              <input type="radio" formControlName="color" [value]="color"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
              <span class="ml-2 text-gray-700">{{color}}</span>
            </label>
            }
          </div>
          @if (carForm.get('color')?.invalid && carForm.get('color')?.touched) {
          <p class="text-red-500 text-sm mt-1">Seleccione un color</p>
          }
        </div>

        <!-- Características (checkboxes) -->
        <div formGroupName="features">
          <label class="block text-sm font-medium text-gray-700 mb-2">Características deseadas*</label>
          <div class="space-y-2">
            <label class="inline-flex items-center">
              <input type="checkbox" formControlName="airConditioning"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
              <span class="ml-2 text-gray-700">Aire acondicionado</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" formControlName="electricWindows"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
              <span class="ml-2 text-gray-700">Vidrios eléctricos</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" formControlName="navigation"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
              <span class="ml-2 text-gray-700">Sistema de navegación</span>
            </label>
          </div>
          @if (carForm.get('features')?.invalid && carForm.get('features')?.touched) {
          <p class="text-red-500 text-sm mt-1">Seleccione al menos una característica</p>
          }
        </div>

        <!-- Fecha de prueba -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Fecha de prueba*</label>
          <input type="date" formControlName="testDate"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"
            [class.border-red-500]="carForm.get('testDate')?.invalid && carForm.get('testDate')?.touched"
            [min]="todayDate()">
          @if (carForm.get('testDate')?.invalid && carForm.get('testDate')?.touched) {
          <p class="text-red-500 text-sm mt-1">
            @if (carForm.get('testDate')?.errors?.['required']) {
            La fecha es requerida
            }
            @if (carForm.get('testDate')?.errors?.['pastDate']) {
            La fecha no puede ser anterior a hoy
            }
          </p>
          }
        </div>

        <!-- Comentarios -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Comentarios</label>
          <textarea formControlName="comments" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"
            [class.border-red-500]="carForm.get('comments')?.invalid && carForm.get('comments')?.touched"></textarea>
          @if (carForm.get('comments')?.invalid && carForm.get('comments')?.touched) {
          <p class="text-red-500 text-sm mt-1">Máximo 200 caracteres</p>
          }
        </div>

        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" (click)="showModal = false"
            class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            Cancelar
          </button>
          <button type="submit" [disabled]="!carForm.valid"
            class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
            Enviar solicitud
          </button>
        </div>
      </form>
    </div>
  </div>
  }

</section>