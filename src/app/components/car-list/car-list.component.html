<section class="w-full h-auto bg-black flex items-center justify-center py-12 px-4">
  <div class="container mx-auto">
    <!-- Barra de búsqueda -->
    <div class="mb-8 relative">
      <input type="text" [(ngModel)]="searchTerm" (input)="filterCars()"
        placeholder="Buscar carros por nombre, descripción o precio..."
        class="w-full p-4 pl-12 bg-gray-800 border-2 border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 text-white placeholder-gray-400 transition-all duration-300 hover:border-amber-400">
    </div>

    @if (isLoading) {
    <div class="text-center py-12 flex justify-center items-center">
      <mat-spinner color="accent"></mat-spinner>
      <span class="ml-3 text-amber-400">Cargando nuestro inventario...</span>
    </div>
    }

    @if (error) {
    <div class="bg-red-900/50 border border-red-600 text-red-100 px-4 py-3 rounded-xl relative" role="alert">
      <strong class="font-bold">¡Error!</strong>
      <span class="block sm:inline ml-2">{{ error }}</span>
    </div>
    }

    @if (!isLoading && !error) {
    @if (filteredCars.length === 0) {
    <div class="text-center py-12">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-500" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p class="text-gray-400 text-xl mt-4">No encontramos autos que coincidan con tu búsqueda</p>
    </div>
    } @else {
    <!-- Grid de autos  -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      @for (car of filteredCars; track car.id) {
      <div
        class="bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border border-gray-700 hover:border-amber-400">
        <div class="relative">
          <img [src]="car.image" [alt]="car.name" class="w-full h-56 object-cover">
          <span class="absolute top-4 right-4 bg-amber-500 text-gray-900 font-bold px-3 py-1 rounded-full text-xs">
            NUEVO
          </span>
        </div>
        <div class="p-6">
          <h3 class="text-xl font-bold text-white mb-2">{{ car.name }}</h3>
          <p class="text-gray-400 mb-4 line-clamp-2">{{ car.description }}</p>
          <div class="flex justify-between items-center">
            <span class="text-2xl font-semibold text-amber-400">${{ car.price | number }}</span>
            <button (click)="openModal(car)"
              class="px-5 py-2.5 bg-gradient-to-r from-amber-500 to-amber-600 text-white font-medium rounded-lg hover:from-amber-600 hover:to-amber-700 transition-all flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path
                  d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
              </svg>
              Comprar
            </button>
          </div>
        </div>
      </div>
      }
    </div>
    }
    }

    <!-- Modal de formulario  -->
    @if (showModal) {
    <div class="modal fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
      <div
        class="form bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
        <!-- Encabezado con efecto de neón -->
        <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-5">
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-900 uppercase tracking-wide">SOLICITAR: {{selectedCar?.name}}</h3>
            <button (click)="showModal = false" class="text-gray-900 hover:text-white transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <p class="text-gray-900/90 text-sm mt-1">Complete el formulario para agendar una prueba de manejo</p>
        </div>

        <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="p-6 space-y-6">
          <!-- Nombre completo - Estilo panel de automóvil -->
          <div class="form-group">
            <label class="block text-sm font-medium text-amber-400 mb-2 uppercase tracking-wider">Nombre
              completo*</label>
            <div class="relative">
              <input type="text" formControlName="fullName"
                class="w-full bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 p-3 pl-10 transition-all"
                placeholder="Ej: Juan Pérez">
              <span class="absolute left-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                    clip-rule="evenodd" />
                </svg>
              </span>
            </div>
            @if (carForm.get('fullName')?.invalid && carForm.get('fullName')?.touched) {
            <p class="text-red-400 text-xs mt-1 italic">
              @if (carForm.get('fullName')?.errors?.['required']) {
              ✖ El nombre es requerido
              }
              @if (carForm.get('fullName')?.errors?.['minlength']) {
              ✖ Mínimo 3 caracteres
              }
            </p>
            }
          </div>

          <!-- Email - Estilo dashboard -->
          <div class="form-group">
            <label class="block text-sm font-medium text-amber-400 mb-2 uppercase tracking-wider">Email*</label>
            <div class="relative">
              <input type="email" formControlName="email"
                class="w-full bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 p-3 pl-10 transition-all"
                placeholder="tucorreo@ejemplo.com">
              <span class="absolute left-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                </svg>
              </span>
            </div>
            @if (carForm.get('email')?.invalid && carForm.get('email')?.touched) {
            <p class="text-red-400 text-xs mt-1 italic">
              @if (carForm.get('email')?.errors?.['required']) {
              ✖ El email es requerido
              }
              @if (carForm.get('email')?.errors?.['email']) {
              ✖ Ingrese un email válido
              }
            </p>
            }
          </div>

          <!-- Método de pago (select) - Estilo palanca de cambios -->
          <div class="form-group">
            <label class="block text-sm font-medium text-amber-400 mb-2 uppercase tracking-wider">Método de
              pago*</label>
            <div class="relative">
              <select formControlName="paymentMethod"
                class="w-full bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 p-3 pl-10 pr-8 appearance-none transition-all">
                <option value="">Seleccione...</option>
                @for (method of paymentMethods; track method) {
                <option [value]="method">{{method}}</option>
                }
              </select>
              <span class="absolute left-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                  <path fill-rule="evenodd"
                    d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                    clip-rule="evenodd" />
                </svg>
              </span>
              <span class="absolute right-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd" />
                </svg>
              </span>
            </div>
            @if (carForm.get('paymentMethod')?.invalid && carForm.get('paymentMethod')?.touched) {
            <p class="text-red-400 text-xs mt-1 italic">✖ Seleccione un método de pago</p>
            }
          </div>

          <!-- Color (radio buttons) -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Color preferido*</label>
            <div class="flex flex-wrap gap-4">
              @for (color of colors; track color) {
              <label class="inline-flex items-center">
                <input type="radio" formControlName="color" [value]="color"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                <span class="ml-2 text-gray-700">{{color}}</span>
              </label>
              }
            </div>
            @if (carForm.get('color')?.invalid && carForm.get('color')?.touched) {
            <p class="text-red-500 text-sm mt-1">Seleccione un color</p>
            }
          </div>

          <!-- Características (checkboxes) -->
          <div formGroupName="features">
            <label class="block text-sm font-medium text-gray-700 mb-2">Características deseadas*</label>
            <div class="space-y-2">
              <label class="inline-flex items-center">
                <input type="checkbox" formControlName="airConditioning"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                <span class="ml-2 text-gray-700">Aire acondicionado</span>
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" formControlName="electricWindows"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                <span class="ml-2 text-gray-700">Vidrios eléctricos</span>
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" formControlName="navigation"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                <span class="ml-2 text-gray-700">Sistema de navegación</span>
              </label>
            </div>
            @if (carForm.get('features')?.invalid && carForm.get('features')?.touched) {
            <p class="text-red-500 text-sm mt-1">Seleccione al menos una característica</p>
            }
          </div>

          <!-- Calendario -->
          <div class="form-group">
            <label class="block text-sm font-medium text-amber-400 mb-2 uppercase tracking-wider">Fecha de
              prueba*</label>
            <div class="relative">
              <input type="date" formControlName="testDate"
                class="w-full bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 p-3 pl-10 transition-all"
                [min]="todayDate()">
              <span class="absolute left-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                    clip-rule="evenodd" />
                </svg>
              </span>
            </div>
            @if (carForm.get('testDate')?.invalid && carForm.get('testDate')?.touched) {
            <p class="text-red-400 text-xs mt-1 italic">
              @if (carForm.get('testDate')?.errors?.['required']) {
              ✖ La fecha es requerida
              }
              @if (carForm.get('testDate')?.errors?.['pastDate']) {
              ✖ La fecha no puede ser anterior a hoy
              }
            </p>
            }
          </div>

          <!-- Comentarios - Estilo cuaderno de notas -->
          <div class="form-group">
            <label class="block text-sm font-medium text-amber-400 mb-2 uppercase tracking-wider">Comentarios</label>
            <div class="relative">
              <textarea formControlName="comments" rows="4"
                class="w-full bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 p-3 pl-10 transition-all"
                placeholder="Alguna preferencia especial..."></textarea>
              <span class="absolute left-3 top-3 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                  <path fill-rule="evenodd"
                    d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"
                    clip-rule="evenodd" />
                </svg>
              </span>
            </div>
            @if (carForm.get('comments')?.invalid && carForm.get('comments')?.touched) {
            <p class="text-red-400 text-xs mt-1 italic">✖ Máximo 200 caracteres</p>
            }
          </div>

          <!-- Botones - Estilo pedales de automóvil -->
          <div class="flex justify-end space-x-4 pt-6">
            <button type="button" (click)="showModal = false"
              class="px-6 py-3 border-2 border-gray-600 rounded-lg shadow-sm text-sm font-medium text-white bg-transparent hover:bg-gray-700 transition-colors">
              Cancelar
            </button>
            <button type="submit" [disabled]="!carForm.valid"
              class="px-6 py-3 rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd" />
              </svg>
              Confirmar Solicitud
            </button>
          </div>
        </form>
      </div>
    </div>
    }
  </div>
</section>